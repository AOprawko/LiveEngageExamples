window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag.agentSDK=lpTag.agentSDK||function(){function a(a){k=g();if(a&&a.notificationCallback&&k){j("binding on notifications");try{k.comply({appName:n.manager,cmdName:o.notify,func:a.notificationCallback})}catch(b){i("Error binding on notifications. The error: "+b)}}}function b(){if(k&&k.dispose)try{k.dispose()}catch(a){i("Error disposing of the courier. The error: "+a)}k=null}function c(a,b,c){if(k&&a){j('Calling "get" on the following key: '+a);try{k.request({appName:n.manager,reqName:p.get,data:{key:a}},function(a,d){a&&c&&c(a);d&&b&&b(d)})}catch(d){i('Error calling "get" on the following key: '+a+". The error: "+d);d&&c&&c(d)}}else{var e;k?a||(e='No key provided when calling "get"'):e='No channel defined when calling "get". Maybe you are missing a call to "init"?';if(e){i(e);c&&c(e)}}}function d(a,b,c){if(k&&a){j('Calling "bind" on the following key: '+a);try{k.bind({appName:n.manager,eventName:a,func:b});k.command({appName:n.manager,cmdName:o.bind,data:{key:a}},c)}catch(d){i('Error calling "bind" on the following key: '+a+". The error: "+d);c&&c(d)}}else{var e;k?a||(e='No key provided when calling "bind"'):e='No channel defined when calling "bind". Maybe you are missing a call to "init"?';if(e){i(e);c&&c(e)}}}function e(a,b,c){if(k&&a){j('Calling "unbind" on the following key: '+a);try{k.unbind({appName:n.manager,eventName:a,func:b});k.command({appName:n.manager,cmdName:o.unbind,data:{key:a}},c)}catch(d){i('Error calling "unbind" on the following key: '+a+". The error: "+d);c&&c(d)}}else{var e;k?a||(e='No key provided when calling "unbind"'):e='No channel defined when calling "unbind". Maybe you are missing a call to "init"?';if(e){i(e);c&&c(e)}}}function f(a,b,c){if(k&&a){j('Calling "command" with the following cmdName: '+a);try{k.command({appName:n.manager,cmdName:a,data:b},c)}catch(d){i('Error calling "command" with the following cmdName: '+a+". The error: "+d);c&&c(d)}}else{var e;k?a||(e='No cmdName provided when calling "command"'):e='No channel defined when calling "command". Maybe you are missing a call to "init"?';if(e){i(e);c&&c(e)}}}function g(){if(lpTag.channel.LPPostMessageCourier){j("Creating an instance of the courier");try{return new lpTag.channel.LPPostMessageCourier}catch(a){i("Error creating instance of courier")}}return void 0}function h(a,b){window.lpTag&&lpTag.log&&lpTag.log(a,b,l)}function i(a){h(a,"ERROR")}function j(a){h(a,"INFO")}var k,l="agentSDK",m="1.0.1",n={manager:"iFrame manager"},o={bind:"Bind",unbind:"Unbind",write:"Write ChatLine",notify:"Notify"},p={get:"Get"};return{v:m,name:l,init:a,get:c,bind:d,unbind:e,command:f,dispose:b,appNames:n,cmdNames:o,reqNames:p}}();!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpEventsUtil",["exports"],function(){d.lpEventsUtil||b(a,d);return d.lpEventsUtil});a.lpTag&&a.lpTag.taglets&&!d.lpEventsUtil&&b(a,d)}else if("object"==typeof exports)b(a,exports);else{d=c();b(a,d)}}(this,function(a,b){"use strict";function c(a,b,c){var d=[];if(a[b]&&a[b].length)for(var e=0;e<a[b].length;e++)c&&"*"!==a[b][e].appName&&a[b][e].appName!==c||d.push(a[b][e]);if(a["*"])for(var f=0;f<a["*"].length;f++)c&&"*"!==a["*"][f].appName&&a["*"][f].appName!==c||d.push(a["*"][f]);return d}function d(b,c,d){a.lpTag&&"function"==typeof a.lpTag.log&&a.lpTag.log(b,c,d)}function e(a){var b,c=a.unbindObj[a.attrName],e=!1;if(!a.unbindObj){d("CMD listen id not spec for unbind","ERROR",a.loggerName);return null}if("string"==typeof a.unbindObj)return i(a.lstnrs,a.unbindObj);if(!a.unbindObj.func&&!a.unbindObj.context&&!a.unbindObj.appName)return!1;var f=a.lstnrs;if(c){f={};f[c]=a.lstnrs[c]}for(var g in f)if(f.hasOwnProperty(g)&&f[g]&&f[g].length){b=j(f[g],a.unbindObj.func,a.unbindObj.context,a.unbindObj.appName);if(b.length!==f[g].length){a.lstnrs[g]=b;e=!0}}return e}function f(a){var b={};if(a.constructor===Object)for(var c in a)a.hasOwnProperty(c)&&null!==a[c]&&void 0!==a[c]&&("object"==typeof a[c]&&a[c].constructor!==Array?b[c]=f(a[c]):a[c].constructor===Array?b[c]=a[c].slice(0)||[]:"function"!=typeof a[c]&&(b[c]=null!==a[c]&&void 0!==a[c]?a[c]:""));else a.constructor===Array?b=a.slice(0)||[]:"function"!=typeof a&&(b=a);return b}function g(a,b,c){if(("undefined"==typeof c||"*"===c)&&"*"===b)return a;for(var d=[],e=0;e<a.length;e++)(a[e].eventName===c||"*"===c)&&(b&&b===a[e].appName||!a[e].appName||"*"===a[e].appName||"*"===b)&&d.push(a[e]);return d}function h(a){if(0===a.eventBufferLimit||a.triggerData.data&&a.triggerData.data.doNotStore)a=null;else{var b={eventName:a.triggerData[a.attrName],appName:a.triggerData.appName};b.data=a.triggerData.passDataByRef?a.triggerData.data:f(a.triggerData.data);if(a.eventBufferLimit>0){a.index>=a.eventBufferLimit&&(a.index=0);a.fired[a.index]=b;a.index++}else a.fired.push(b);a=null}}function i(a,b){var c=!1;if(!b){d("Ev listen id not spec for unregister","ERROR","Events");return null}for(var e in a)if(a.hasOwnProperty(e))for(var f=0;f<a[e].length;f++)if(a[e][f].id==b){a[e].splice(f,1);d("Ev listen="+b+" and name="+e+" unregister","DEBUG","Events");c=!0;break}c||d("Ev listen not found "+b+" unregister","DEBUG","Events");return c}function j(a,b,c,e){var f=[];if(a&&a.length)for(var g=0;g<a.length;g++)try{var h=!c&&a[g].func===b,i=!b&&c&&a[g].context===c,j=b&&c&&a[g].func===b&&a[g].context===c,k=e&&e===a[g].appName,l="*"===a[g].appName;if(h||i||j){if(k||l)continue;if(i)continue}else if(!b&&!c&&k)continue;f.push(a[g])}catch(m){d("Error in unbind e="+m.message,"ERROR","Events")}return f}b.lpEventsUtil=b.lpEventsUtil||{getListeners:c,log:d,unbind:e,hasFired:g,cloneEventData:f,storeEventData:h}});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpEvents",["exports","lpEventsUtil"],function(){d.LPEvents||b(a,d,d.lpEventsUtil);return d.LPEvents});a.lpTag&&a.lpTag.taglets&&!d.LPEvents&&b(a,d,d.lpEventsUtil)}else if("object"==typeof exports)b(a,exports,require("util/lpEventsUtil"));else{d=c();b(a,d,d.lpEventsUtil)}}(this,function(a,b,c){"use strict";function d(a){function b(a){if(a){a.triggerOnce=!0;return d(a)}return null}function d(a,b,e){var f=a;"string"==typeof a&&(f={appName:a,eventName:b,func:e});if(!f.eventName||!f.func||"function"!=typeof f.func&&f.func.constructor!==Array){c.log("Ev listen has invalid params: evName=["+f.eventName+"]","ERROR","Events");return null}if(f.func.constructor===Array){for(var g,h,i=[],j=0;j<f.func.length;j++){g=c.cloneEventData(f);g.func=f.func[j];h=d(g);i.push(h)}return i}var k=q+n++,l={id:k,func:f.func,context:f.context||null,aSync:f.aSync?!0:!1,appName:f.appName||"*",triggerOnce:f.triggerOnce||!1};o[f.eventName]=o[f.eventName]||[];o[f.eventName].push(l);c.log("Ev listen rgstr: evName=["+f.eventName+"] aSync="+l.aSync+" appName="+l.name,"DEBUG","Events");f=null;a=null;return k}function e(a){return c.unbind({unbindObj:a,attrName:m,loggerName:l,lstnrs:o})}function f(a,b){return c.hasFired(p,a,b)}function g(a,b,d){var e=a;"string"==typeof a&&(e={eventName:b,appName:a,data:d});if(!e||"undefined"==typeof e.eventName){c.log("Ev name not spec for publish","ERROR","Events");e=null;return null}e.passDataByRef=e.passDataByRef||!j;i(e);var f=c.getListeners(o,e.eventName,e.appName);if(f.length>0)for(var g=0;g<f.length;g++){var k=e.passDataByRef?e.data:c.cloneEventData(e.data),l={appName:e.appName,eventName:e.eventName},m=f[g];m.aSync||k&&k.aSync?setTimeout(h(m,k,l),0):h(m,k,l)()}e=null;return f.length>0}function h(a,b,d){return function(){try{a.func.call(a.context,b,d);b=null;a.triggerOnce&&e(a);a=null}catch(f){c.log("Error executing "+d.eventName+" eventId: "+a.id+"e="+f.message,"ERROR","Events")}}}function i(a){c.storeEventData({triggerData:a,eventBufferLimit:k,attrName:m,fired:p,index:r})}var j,k,l="Events",m="eventName",n=0,o={},p=[],q="evId_",r=0;j=a&&"boolean"==typeof a.cloneEventData?a.cloneEventData:!1;k=a&&!isNaN(a.eventBufferLimit)?a.eventBufferLimit:-1;this.once=b;this.hasFired=f;this.trigger=g;this.publish=g;this.bind=d;this.register=d;this.unbind=e;this.unregister=e}b.LPEvents=b.LPEvents||d});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpCommandUtil",["exports","lpEventsUtil"],function(){d.lpCommandUtil||b(a,d,d.lpEventsUtil);return d.lpCommandUtil});a.lpTag&&a.lpTag.taglets&&!d.lpCommandUtil&&b(a,d,d.lpEventsUtil)}else if("object"==typeof exports)b(a,exports,require("util/lpEventsUtil"));else{d=c();b(a,d,d.lpEventsUtil)}}(this,function(a,b,c){"use strict";function d(a){var b=a.cmd[a.attrName];if(!b||!a.cmd.func||"function"!=typeof a.cmd.func||!e(a.cmd,b)){c.log("comply: has invalid params: command=["+b+"]","ERROR",a.loggerName);return null}if(a.lstnrs[b]&&a.lstnrs[b].length){c.log("comply: cannot comply because command already exist command="+b,"ERROR",a.loggerName);return null}var d=a.prefix+a.id++,f={id:d,func:a.cmd.func,context:a.cmd.context||null,appName:a.cmd.appName};a.lstnrs[b]=a.lstnrs[b]||[];a.lstnrs[b].push(f);c.log("Cmd comply: evName=["+b+"] appName="+f.appName,"DEBUG",a.loggerName);return d}function e(a,b){return!(b&&"*"===b||a.appName&&"*"===a.appName)}b.lpCommandUtil=b.lpCommandUtil||{bind:d,valid:e}});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpCommands",["exports","lpEventsUtil","lpCommandUtil"],function(){d.lpCommands||b(a,d,d.lpEventsUtil,d.lpCommandUtil);return d.LPCommands});a.lpTag&&a.lpTag.taglets&&!d.lpCommands&&b(a,d,d.lpEventsUtil,d.lpCommandUtil)}else if("object"==typeof exports)b(a,exports,require("util/lpEventsUtil"),require("util/lpCommandUtil"));else{d=c();b(a,d,d.lpEventsUtil,d.lpCommandUtil)}}(this,function(a,b,c,d){"use strict";function e(a){function b(a){return d.bind({cmd:a,attrName:l,loggerName:k,prefix:p,id:m,lstnrs:n})}function e(a){return c.unbind({unbindObj:a,attrName:l,loggerName:k,lstnrs:n})}function f(a,b){return c.hasFired(o,a,b)}function g(a,b){if(!a||"undefined"==typeof a.cmdName||!d.valid(a,a.cmdName)){c.log("CMD name not spec for command","ERROR","Commands");return null}a.passDataByRef=a.passDataByRef||!i;h(a);if(!n[a.cmdName])return!1;var e=c.getListeners(n,a.cmdName,a.appName);if(e.length>0)for(var f=0;f<e.length;f++){var g=a.passDataByRef?a.data:c.cloneEventData(a.data),j=e[f];try{"function"==typeof b?j.func.call(j.context,g,b):j.func.call(j.context,g);g=null;j=null}catch(k){if("function"==typeof b)try{b(k)}catch(l){c.log("Error executing callback on error, "+a.cmdName+" commandId: "+j.id+"e="+l.message,"ERROR","Commands")}c.log("Error executing "+a.cmdName+" commandId: "+j.id+"e="+k.message,"ERROR","Commands")}}return e.length>0}function h(a){c.storeEventData({triggerData:a,eventBufferLimit:j,attrName:l,fired:o,index:q})}var i,j,k="Commands",l="cmdName",m=0,n={},o=[],p="cmdId_",q=0;i=a&&"boolean"==typeof a.cloneEventData?a.cloneEventData:!1;j=a&&!isNaN(a.eventBufferLimit)?a.eventBufferLimit:-1;this.hasFired=f;this.comply=b;this.stopComplying=e;this.command=g}b.LPCommands=b.LPCommands||e});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpReqres",["exports","lpEventsUtil","lpCommandUtil"],function(){d.LPReqRes||b(a,d,d.lpEventsUtil,d.lpCommandUtil);return d.LPReqRes});a.lpTag&&a.lpTag.taglets&&!d.LPReqRes&&b(a,d,d.lpEventsUtil,d.lpCommandUtil)}else if("object"==typeof exports)b(a,exports,require("util/lpEventsUtil"),require("util/lpCommandUtil"));else{d=c();b(a,d,d.lpEventsUtil,d.lpCommandUtil)}}(this,function(a,b,c,d){function e(a){function b(a){return d.bind({cmd:a,attrName:l,loggerName:k,prefix:p,id:m,lstnrs:n})}function e(a){return c.unbind({unbindObj:a,attrName:l,loggerName:k,lstnrs:n})}function f(a,b){return c.hasFired(o,a,b)}function g(a,b){var e;if(!a||"undefined"==typeof a.reqName||!d.valid(a,a.reqName)){c.log("request: name not spec for command","ERROR","ReqRes");throw new Error("Invalid request object")}a.passDataByRef=a.passDataByRef||!i;h(a);if(!n[a.reqName])return e;var f=c.getListeners(n,a.reqName,a.appName);if(f.length>0)for(var g=0;g<f.length;g++){var j=a.passDataByRef?a.data:c.cloneEventData(a.data),k={appName:a.appName,reqName:a.reqName},l=f[g];try{e="function"==typeof b?l.func.call(l.context,j,b):l.func.call(l.context,j);j=null;l=null}catch(m){if("function"==typeof b)try{b(m)}catch(o){c.log("Error executing callback on error, "+k.reqName+" requestId: "+l.id+"e="+o.message,"ERROR","ReqRes")}c.log("Error executing "+k.reqName+" requestId: "+l.id+"e="+m.message,"ERROR","ReqRes")}}return e}function h(a){c.storeEventData({triggerData:a,eventBufferLimit:j,attrName:l,fired:o,index:q})}var i,j,k="ReqRes",l="reqName",m=0,n={},o=[],p="reqId_",q=0;i=a&&"boolean"==typeof a.cloneEventData?a.cloneEventData:!1;j=a&&!isNaN(a.eventBufferLimit)?a.eventBufferLimit:-1;this.hasFired=f;this.request=g;this.reply=b;this.stopReplying=e}b.LPReqRes=b.LPReqRes||e});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpEventChannel",["exports","lpEvents","lpCommands","lpReqres"],function(){d.LPEventChannel||b(a,d,d.LPEvents,d.LPCommands,d.LPReqRes);return d.LPEventChannel});a.lpTag&&a.lpTag.taglets&&!d.LPEventChannel&&b(a,d,d.LPEvents,d.LPCommands,d.LPReqRes)}else if("object"==typeof exports)b(a,exports,require("./lpEvents"),require("./lpCommands"),require("./lpReqres"));else{d=c();b(a,d,d.LPEvents,d.LPCommands,d.LPReqRes)}}(this,function(a,b,c,d,e){function f(a){a=a||{};var b=a.events||new c,f=a.commands||new d,g=a.reqres||new e;this.once=b.once;this.hasFiredEvents=b.hasFired;this.trigger=b.trigger;this.publish=b.publish;this.bind=b.bind;this.register=b.register;this.unbind=b.unbind;this.unregister=b.unregister;this.hasFiredCommands=f.hasFired;this.comply=f.comply;this.stopComplying=f.stopComplying;this.command=f.command;this.hasFiredReqres=g.hasFired;this.request=g.request;this.reply=g.reply;this.stopReplying=g.stopReplying}b.LPEventChannel=b.LPEventChannel||f});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpCircuitBreaker",["exports"],function(){d.LPCircuitBreaker||b(a,d);return d.LPCircuitBreaker});a.lpTag&&a.lpTag.taglets&&!d.LPCircuitBreaker&&b(a,d)}else if("object"==typeof exports)b(a,exports);else{d=c();b(a,d)}}(this,function(a,b){"use strict";function c(a){if(!1==this instanceof c)return new c(a);this.initialize(a);return void 0}function d(a){function b(){}function c(){return e.apply(this instanceof b&&a?this:a,d.concat(Array.prototype.slice.call(arguments)))}var d,e;if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");d=Array.prototype.slice.call(arguments,1);e=this;b.prototype=this.prototype;c.prototype=new b;return c}var e={OPEN:0,HALF_OPEN:1,CLOSED:2},f={FAILURE:"failure",SUCCESS:"success",TIMEOUT:"timeout",OUTAGE:"outage"};c.prototype=function(){function a(a){if(!this.initialized){a=a||{};this.timeWindow=!isNaN(a.timeWindow)&&0<a.timeWindow?parseInt(a.timeWindow,10):3e4;this.slidesNumber=!isNaN(a.slidesNumber)&&0<a.slidesNumber?parseInt(a.slidesNumber,10):10;this.tolerance=!isNaN(a.tolerance)&&0<a.tolerance?parseInt(a.tolerance,10):50;this.calibration=!isNaN(a.calibration)&&0<a.calibration?parseInt(a.calibration,10):5;this.onopen="function"==typeof a.onopen?a.onopen:function(){};this.onclose="function"==typeof a.onclose?a.onclose:function(){};this.slides=[m.call(this)];this.state=e.CLOSED;this.initialized=!0;l.call(this)}}function b(a,b){if(i.call(this)){q.call(this,b||function(){});return!1}return p.call(this,a)}function c(){this.forced=this.state;this.state=e.OPEN}function g(){this.forced=this.state;this.state=e.CLOSED}function h(){this.state=this.forced;this.forced=void 0}function i(){return e.OPEN===this.state}function j(){for(var a,b=0,c=0,d=0,e=this.slides.length;e>d;d++){var g=this.slides[d],h=g[f.FAILURE]+g[f.TIMEOUT];c+=h;b+=h+g[f.SUCCESS]}a=c/(b>0?b:1)*100;return{total:b,error:c,percent:a}}function k(){this.timer&&clearTimeout(this.timer);this.slides.length>this.slidesNumber&&this.slides.shift();this.slideIndex++;if(this.slideIndex>this.slidesNumber){this.slideIndex=0;i.call(this)&&(this.state=e.HALF_OPEN)}this.slides.push(m.call(this));this.slides.length>this.slidesNumber&&this.slides.shift();this.timer=setTimeout(k.bind(this),this.slidingWindow)}function l(){this.slideIndex=0;this.slidingWindow=this.timeWindow/this.slidesNumber;this.timer&&clearTimeout(this.timer);this.timer=setTimeout(k.bind(this),this.slidingWindow)}function m(){var a={};a[f.FAILURE]=0;a[f.SUCCESS]=0;a[f.TIMEOUT]=0;a[f.OUTAGE]=0;return a}function n(){return this.slides[this.slides.length-1]}function o(a,b){return function(){if(!b.done){var c=n.call(this);c[a]++;"undefined"==typeof this.forced&&r.call(this);b.done=!0}}}function p(a){var b,c={done:!1},d=o(f.SUCCESS,c).bind(this),e=o(f.FAILURE,c).bind(this),g=o(f.TIMEOUT,c).bind(this);try{b=a(d,e,g)}catch(h){e();return!1}return b}function q(a){try{a()}catch(b){}var c=n.call(this);c[f.OUTAGE]++}function r(){var a=j.call(this);if(e.HALF_OPEN===this.state){var b=!n.call(this)[f.SUCCESS]&&0<a.error;if(b)this.state=e.OPEN;else{this.state=e.CLOSED;this.onclose(a)}}else{var c=a.percent>this.tolerance,d=a.total>this.calibration,g=d&&c;if(g){this.state=e.OPEN;this.onopen(a)}}}return{initialize:a,run:b,close:g,open:c,reset:h,isOpen:i,calculate:j,bind:d}}();c.STATE=e;Function.prototype.bind||(Function.prototype.bind=d);b.LPCircuitBreaker=b.LPCircuitBreaker||c});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpTtlCache",["exports"],function(){d.LPTtlCache||b(a,d);return d.LPTtlCache});a.lpTag&&a.lpTag.taglets&&!d.LPTtlCache&&b(a,d)}else if("object"==typeof exports)b(a,exports);else{d=c();b(a,d)}}(this,function(a,b){"use strict";function c(a){if(!1==this instanceof c)return new c(a);this.initialize(a);return void 0}c.prototype=function(){function a(a){if(!this.initialized){a=a||{};this.cache={};this.length=0;this.max=!isNaN(a.max)&&0<a.max?parseInt(a.max,10):0;this.ttl=!isNaN(a.ttl)&&0<a.ttl?parseInt(a.ttl,10):0;this.interval=!isNaN(a.interval)&&0<a.interval?parseInt(a.interval,10):1e3;this.ontimeout="function"==typeof a.ontimeout?a.ontimeout:function(){};this.initialized=!0;g.call(this)}}function b(a,b){var c=b?d.call(this,a):this.cache&&this.cache[a]&&this.cache[a].item;return c}function c(a,b,c,d){return f.call(this,a,b,c,d)}function d(a){var b=this.cache&&this.cache[a]&&this.cache[a].item;if(b){this.cache[a].item=null;this.cache[a].callback=null;this.cache[a].timeout=null;this.cache[a]=null;delete this.cache[a];this.length--}return b}function e(){if(this.length)for(var a in this.cache)this.cache.hasOwnProperty(a)&&d.call(this,a)}function f(a,b,c,d){var e,f;if(0===this.max||this.length<this.max){e=!isNaN(c)&&c>=0?parseInt(c,10):this.ttl;this.cache[a]={item:b};this.length++;if(e){f=(new Date).getTime()+e;this.cache[a].timeout=f}"function"==typeof d&&(this.cache[a].callback=d);e&&(this.cache[a].callback||"function"==typeof this.ontimeout)&&g.call(this);return!0}return!1}function g(){var a,b,c,e;this.timer&&clearTimeout(this.timer);if(this.length)for(var f in this.cache)if(this.cache.hasOwnProperty(f)&&this.cache[f].timeout&&this.cache[f].timeout<=(new Date).getTime()){b=this.cache[f].item;a=this.cache[f].callback;a&&(c=a(f,b));this.ontimeout&&(e=this.ontimeout(f,b));c!==!1&&e!==!1&&d.call(this,f)}this.timer=setTimeout(g.bind(this),this.interval)}return{initialize:a,get:b,set:c,remove:d,removeAll:e}}();b.LPTtlCache=b.LPTtlCache||c});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpPostMessageUtilities",["exports"],function(){d.LPPostMessageUtilities||b(a,d);return d.LPPostMessageUtilities});a.lpTag&&a.lpTag.taglets&&!d.LPPostMessageUtilities&&b(a,d)}else if("object"!=typeof exports){d=c();b(a,d)}}(this,function(a,b){"use strict";function c(){var a,b;if("function"==typeof Array.prototype.toJSON){b=Array.prototype.toJSON;Array.prototype.toJSON=void 0;try{a=JSON.stringify.apply(null,arguments)}catch(c){Array.prototype.toJSON=b;throw c}Array.prototype.toJSON=b}else a=JSON.stringify.apply(null,arguments);return a}function d(){var b=!0;try{a.postMessage({toString:function(){b=!1}},"*")}catch(c){}return b}function e(a){return a&&a.replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}function f(a,b){return!isNaN(a)&&a>0?parseInt(a,10):b}function g(a,b){return"function"==typeof a?a:!0===b?function(){}:b}function h(a,b,c){var d,e,f,g=new RegExp(/(http{1}s{0,1}?:\/\/)([^\/\?]+)(\/?)/gi);if(!a||0!==a.indexOf("http")){f=c?b.top||b.contentWindow&&b.contentWindow.parent||window:b;return f.location.protocol+"//"+f.location.host}d=g.exec(a);d&&3<=d.length&&""!==d[2]&&(e=d[1].toLowerCase()+d[2].toLowerCase());return e}function i(a,b){var c,d,e;try{d=a&&a.contentWindow&&"undefined"!=typeof Window&&!(a instanceof Window)&&a.getAttribute&&a.getAttribute("src")}catch(f){}try{if(!d){d=j("lpHost");if(!d){e=j("hostParam");e&&(d=j(e))}}d||(d=document.referrer);d&&(d=decodeURIComponent(d));c=h(d,a,b)}catch(f){n("Cannot parse origin","ERROR","PostMessageUtilities")}return c||"*"}function j(a){return decodeURIComponent((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(document.location.search)||[void 0,""])[1].replace(/\+/g,"%20"))||null}function k(a,b){"undefined"!=typeof setImmediate&&(isNaN(b)||0>=b)?setImmediate(a):!1===b?a():setTimeout(a,isNaN(b)||0>=b?0:parseInt(b,10))}function l(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c);return function(){m(a,b,c)}}function m(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)}function n(b,c,d){a.lpTag&&"function"==typeof a.lpTag.log&&a.lpTag.log(b,c,d)}function o(a){function b(){}function c(){return e.apply(this instanceof b&&a?this:a,d.concat(Array.prototype.slice.call(arguments)))}var d,e;if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");d=Array.prototype.slice.call(arguments,1);e=this;b.prototype=this.prototype;c.prototype=new b;return c}var p="_xxxxxx-4xxx-yxxx";Function.prototype.bind||(Function.prototype.bind=o);b.LPPostMessageUtilities=b.LPPostMessageUtilities||{SEQUENCE_FORMAT:p,stringify:c,hasPostMessageObjectsSupport:d,createUniqueSequence:e,parseNumber:f,parseFunction:g,getHost:h,resolveOrigin:i,getURLParameter:j,delay:k,addEventListener:l,removeEventListener:m,log:n,bind:o}});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpPostMessageChannelPolyfill",["exports","lpPostMessageUtilities"],function(){d.LPPostMessageChannelPolyfill||b(a,d,d.LPPostMessageUtilities);return d.LPPostMessageChannelPolyfill});a.lpTag&&a.lpTag.taglets&&!d.LPPostMessageChannelPolyfill&&b(a,d,d.LPPostMessageUtilities)}else if("object"!=typeof exports){d=c();b(a,d,d.LPPostMessageUtilities)}}(this,function(a,b,c){"use strict";function d(a,b){if(!1==this instanceof d)return new d(a,b);this.initialize(a,b);return void 0}var e="LPPort_";d.prototype=function(){function b(b,d){if(!this.initialized){d=d||{};this.target=b||a.top;this.hosted=this.target===a||this.target===a.top;this.portId=c.createUniqueSequence(e+c.SEQUENCE_FORMAT);this.serialize=c.parseFunction(d.serialize,c.stringify);this.deserialize=c.parseFunction(d.deserialize,JSON.parse);this.initialized=!0}}function d(a){var b,d,e=g.call(this),f=this.target;if(a)try{this.hosted||(f=this.target.contentWindow);b=h.call(this,a);d=this.serialize(b);f.postMessage(d,e)}catch(i){c.log("Error while trying to post the message","ERROR","PostMessageChannelPolyfill");return!1}}function f(a){var b;if("function"==typeof this.onmessage){b=i.call(this,a);return this.onmessage(b)}}function g(){this.origin||(this.origin=c.resolveOrigin(this.target));return this.origin}function h(a){return{port:this.portId,message:a}}function i(a){var b;if(a&&a.data)try{b=this.deserialize(a.data);if(b.port&&0===b.port.indexOf(e))return{origin:a.origin,data:b.message}}catch(d){c.log("Error while trying to deserialize the message","ERROR","PostMessageChannelPolyfill")}return b||a}return{initialize:b,postMessage:d,receive:f}}();b.LPPostMessageChannelPolyfill=b.LPPostMessageChannelPolyfill||d});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpPostMessageChannel",["exports","lpPostMessageUtilities","lpPostMessageChannelPolyfill"],function(){d.LPPostMessageChannel||b(a,d,d.LPPostMessageUtilities,d.LPPostMessageChannelPolyfill);return d.LPPostMessageChannel});a.lpTag&&a.lpTag.taglets&&!d.LPPostMessageChannel&&b(a,d,d.LPPostMessageUtilities,d.LPPostMessageChannelPolyfill)}else if("object"!=typeof exports){d=c();b(a,d,d.LPPostMessageUtilities,d.LPPostMessageChannelPolyfill)}}(this,function(a,b,c,d){"use strict";function e(a,b){if(!1==this instanceof e)return new e(a,b);this.initialize(a,b);return void 0}var f="LPFRM",g="LPTKN",h="HNDSK",i=100,j=5e3,k=3,l=100;e.prototype=function(){function b(b,e){function f(a){var b,d;if(a.ports&&0<a.ports.length){this.receiver=a.ports[0];s.call(this,a)&&(this.token||(this.token=a.data));this.receiver.start();d=this.removeListener.bind(this);this.removeListener=c.addEventListener(this.receiver,"message",m);d();this.hosted&&!this.ready&&(b=!0)}else if(s.call(this,a)){this.token||(this.token=a.data);this.hosted&&!this.ready&&(b=!0)}else this.token&&this.receiver.receive.call(this.receiver,a);if(b){this.receiver.postMessage(h+this.token);x.call(this)}}var l,m,n;if(!this.initialized){this.hosted=!1;this.messageQueue=[];b=b||{};this.serialize=c.parseFunction(b.serialize,c.stringify);this.deserialize=c.parseFunction(b.deserialize,JSON.parse);this.targetOrigin=b.targetOrigin;this.maxConcurrency=c.parseNumber(b.maxConcurrency,i);this.handshakeInterval=c.parseNumber(b.handshakeInterval,j);this.handshakeAttempts=c.parseNumber(b.handshakeAttempts,k);this.hostParam=b.hostParam;this.channel="undefined"!=typeof b.channel?b.channel:o();this.useObjects=b.useObjects;this.onready=t(b.onready,b.target).bind(this);this.removeDispose=b.removeDispose;m=u(e).bind(this);this.channelFactory=p.call(this,m);if(!b.target||(b.target!==a||b.target===a.top)&&"undefined"!=typeof Window&&b.target instanceof Window){this.hosted=!0;this.target=b.target||a.top}else if(b.target.contentWindow)this.target=b.target;else if(b.target.url){this.targetUrl=b.target.url;this.targetOrigin=this.targetOrigin||c.getHost(b.target.url)}this.hosted||(this.token=c.createUniqueSequence(g+c.SEQUENCE_FORMAT));if(this.targetUrl){this.loading=!0;this.targetContainer=b.target.container||document.body;this.target=z.call(this,b.target,this.targetContainer)}if(!v.call(this)){this.receiver=new d(this.target,{serialize:this.serialize,deserialize:this.deserialize});this.receiver.onmessage=m}if(this.hosted||!v.call(this)){l=f.bind(this);this.removeListener=c.addEventListener(a,"message",l)}else v.call(this)&&this.channelFactory();if(this.target&&!this.loading&&!this.ready){try{n=w.call(this)}catch(q){n=!1}if(!n){this.channel=!1;this.receiver=new d(this.target,{serialize:this.serialize,deserialize:this.deserialize});this.receiver.onmessage=m;if(!this.hosted){l=f.bind(this);this.removeListener=c.addEventListener(a,"message",l)}w.call(this)}this.handshakeAttempts--;c.delay(function(){if(!this.hosted&&!this.ready){A.call(this,this.target);this.timer=c.delay(w.bind(this,this.handshakeInterval),this.handshakeInterval)}}.bind(this))}this.initialized=!0}}function e(){if(!this.disposed){if(this.removeListener){this.removeListener.call(this);this.removeListener=void 0}if(this.targetUrl&&this.target||this.removeDispose)try{this.targetContainer?this.targetContainer.removeChild(this.target):document.body.removeChild(this.target)}catch(a){c.log("Error while trying to remove the iframe from the container","ERROR","PostMessageChannel")}this.messageQueue.length=0;this.messageQueue=void 0;this.channel=void 0;this.onready=void 0;this.disposed=!0}}function m(a,b,d){var e,f;if(!this.disposed)try{if(a){if(this.ready||d){e=b||this.receiver;f=n.call(this,a);e.postMessage(f);return!0}if(this.maxConcurrency>=this.messageQueue.length){this.messageQueue.push(a);return!0}return!1}}catch(g){c.log("Error while trying to post the message","ERROR","PostMessageChannel");return!1}}function n(a){q.call(this,a);return this.serialize(a)}function o(){return"true"===c.getURLParameter("lpPMCPolyfill")?!1:void 0}function p(a){return function(){this.channel=new MessageChannel;this.receiver=this.channel.port1;this.dispatcher=this.channel.port2;this.receiver.onmessage=a;this.neutered=!1}.bind(this)}function q(a){this.token&&(a.token=this.token)}function r(a){return a&&a.token===this.token}function s(a){return a&&a.data&&"string"==typeof a.data&&(0===a.data.indexOf(g)||h+this.token===a.data)}function t(a,b){return function(c){b&&"function"==typeof b.callback&&b.callback.call(b.context,c,this.target);a&&("function"==typeof a?a(c,this.target):"function"==typeof a.callback&&a.callback.call(a.context,c,this.target))}}function u(a){return function(b){var d;if(!b.origin||"*"===b.origin||this.targetOrigin===b.origin){if(!s.call(this,b)||this.hosted||this.ready){try{d=this.deserialize(b.data);if(r.call(this,d))return a&&a(d)}catch(e){d=b.data||b;c.log("Error while trying to handle the message","ERROR","PostMessageChannel")}return d||b}x.call(this)}}}function v(){return!1!==this.channel&&"undefined"!=typeof MessageChannel&&"undefined"!=typeof MessagePort}function w(a){this.timer&&clearTimeout(this.timer);if(!this.ready){v.call(this)||(this.targetOrigin=this.targetOrigin||c.resolveOrigin(this.target)||"*");if(!this.hosted)if(v.call(this))try{this.neutered&&this.channelFactory();this.target.contentWindow.postMessage(this.token,this.targetOrigin,[this.dispatcher]);this.neutered=!0}catch(b){return!1}else this.target.contentWindow.postMessage(this.token,this.targetOrigin)}if(!this.ready&&a)if(0<this.handshakeAttempts){this.handshakeAttempts--;this.timer=c.delay(w.bind(this,a),a)}else this.onready(new Error("Loading: Operation Timeout!"));return!0}function x(){if(!this.ready){this.ready=!0;this.messageQueue&&this.messageQueue.length?c.delay(function(){var a,b;if(this.ready){for(;this.messageQueue&&this.messageQueue.length;){a=this.messageQueue.shift();try{b=n.call(this,a);this.receiver.postMessage(b)}catch(d){c.log("Error while trying to post the message from queue","ERROR","PostMessageChannel")}}this.onready()}}.bind(this)):this.onready()}}function y(b){function d(){f.body?e():c.delay(d,g||l)}b=b||{};var e=b.onready,f=b.doc||a.document,g=b.delay;c.delay(d,g||!1)}function z(a,b){var d=document.createElement("IFRAME"),e=c.createUniqueSequence(f+c.SEQUENCE_FORMAT),g=a.delayLoad;d.setAttribute("id",e);d.setAttribute("name",e);d.setAttribute("tabindex","-1");d.setAttribute("aria-hidden","true");d.setAttribute("title","");d.setAttribute("role","presentation");d.setAttribute("allowTransparency","true");if(a.style)for(var h in a.style)a.style.hasOwnProperty(h)&&(d.style[h]=a.style[h]);else{d.style.width="0px";d.style.height="0px";d.style.position="absolute";

d.style.top="-1000px";d.style.left="-1000px"}y({delay:g,onready:function(){(b||document.body).appendChild(d);A.call(this,d);B.call(this,d,a.url,!1!==a.bust)}.bind(this)});return d}function A(a){c.addEventListener(a,"load",function(){this.loading=!1;w.call(this,this.handshakeInterval)}.bind(this))}function B(a,b,d){b+=0<b.indexOf("?")?"&":"?";if(d){b+="bust=";b+=(new Date).getTime()+"&"}b+=(this.hostParam?"hostParam="+this.hostParam+"&"+this.hostParam+"=":"lpHost=")+encodeURIComponent(c.getHost(void 0,a,!0));v.call(this)||(b+="&lpPMCPolyfill=true");!1===this.useObjects&&(b+="&lpPMDeSerialize=true");a.setAttribute("src",b)}return{initialize:b,postMessage:m,dispose:e}}();b.LPPostMessageChannel=e});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpPostMessagePromise",["exports"],function(){d.LPPostMessagePromise||b(a,d);return d.LPPostMessagePromise});a.lpTag&&a.lpTag.taglets&&!d.LPPostMessagePromise&&b(a,d)}else if("object"!=typeof exports){d=c();b(a,d)}}(this,function(a,b){"use strict";function c(a){if(!1==this instanceof c)return new c(a);this.initialize(a);return void 0}var d={RESOLVE:"resolve",REJECT:"reject",PROGRESS:"progress"};c.prototype=function(){function a(a){if(!this.initialized){this.queue=[];this.actions={resolve:c.bind(this),reject:e.bind(this),progress:f.bind(this)};"function"==typeof a&&a.call(this,this.actions.resolve,this.actions.reject);this.initialized=!0}}function b(a,b,c){this.queue.push({resolve:a,reject:b,progress:c})}function c(a){h.call(this,d.RESOLVE,a)}function e(a){h.call(this,d.REJECT,a)}function f(a){g.call(this,d.PROGRESS,a)}function g(a,b,c){for(var d=0,e=this.queue[d++];e;){e[a]&&e[a].call(this,b);e=this.queue[d++]}c&&(this.queue.length=0)}function h(a,b){var c=this.actions[a];this.then=function(){c&&c.call(this,b)}.bind(this);this.resolve=this.reject=function(){throw new Error("This Promise instance had already been completed.")};this.progress=function(){return!1};g.call(this,a,b,!0);delete this.queue}return{initialize:a,then:b,resolve:c,reject:e,progress:f}}();c.polyfill=function(){a.Promise||(a.Promise=c)};b.LPPostMessagePromise=b.LPPostMessagePromise||c});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpPostMessageMapper",["exports","lpPostMessageUtilities"],function(){d.LPPostMessageMapper||b(a,d,d.LPPostMessageUtilities);return d.LPPostMessageMapper});a.lpTag&&a.lpTag.taglets&&!d.LPPostMessageMapper&&b(a,d,d.LPPostMessageUtilities)}else if("object"!=typeof exports){d=c();b(a,d,d.LPPostMessageUtilities)}}(this,function(a,b,c){"use strict";function d(a){if(!1==this instanceof d)return new d(a);this.initialize(a);return void 0}d.prototype=function(){function a(a){if(!this.initialized){this.eventChannel=a;this.initialized=!0}}function b(a){if(a){if(a.error){c.log("Error on message: "+a.error,"ERROR","PostMessageMapper");return function(){return a}}return e.call(this,a)}}function d(a,b){return{method:{id:a,name:b,args:Array.prototype.slice.call(arguments,2)}}}function e(a){var b=a&&a.method,d=(b&&b.id,b&&b.name),e=b&&b.args,f=this.eventChannel;return function(){if(f&&f[d])return f[d].apply(f,e);c.log("No channel exists","ERROR","PostMessageMapper");return void 0}}return{initialize:a,toEvent:b,toMessage:d}}();b.LPPostMessageMapper=b.LPPostMessageMapper||d});!function(a,b){"use strict";function c(){if(a.lpTag){a.lpTag.channel=a.lpTag.channel||{};return a.lpTag.channel}return a}var d;if("function"==typeof define&&define.amd){d=c();define("lpPostMessageCourier",["exports","lpPostMessageUtilities","lpEventChannel","lpTtlCache","lpCircuitBreaker","lpPostMessageChannel","lpPostMessagePromise","lpPostMessageMapper"],function(){d.LPPostMessageCourier||b(a,d,d.LPPostMessageUtilities,d.LPEventChannel,d.LPTtlCache,d.LPCircuitBreaker,d.LPPostMessageChannel,d.LPPostMessagePromise,d.LPPostMessageMapper);return d.LPPostMessageCourier});a.lpTag&&a.lpTag.taglets&&!d.LPPostMessageCourier&&b(a,d,d.LPPostMessageUtilities,d.LPEventChannel,d.LPTtlCache,d.LPCircuitBreaker,d.LPPostMessageChannel,d.LPPostMessagePromise,d.LPPostMessageMapper)}else if("object"!=typeof exports){d=c();b(a,d,d.LPPostMessageUtilities,d.LPEventChannel,d.LPTtlCache,d.LPCircuitBreaker,d.LPPostMessageChannel,d.LPPostMessagePromise,d.LPPostMessageMapper)}}(this,function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){if(!1==this instanceof j)return new j(a);this.initialize(a);return void 0}var k="LPMSG_",l={TRIGGER:"trigger",COMMAND:"command",REQUEST:"request",RETURN:"return"},m=3e4,n=100,o=3e4,p=30,q=10,r=1e3;j.prototype=function(){function a(a){var b,h,j;if(!this.initialized){a=a||{};this.useObjects=!1===a.useObjects?a.useObjects:w();"undefined"==typeof this.useObjects&&(this.useObjects=!0);a.useObjects=this.useObjects;if("function"!=typeof a.serialize||"function"!=typeof a.deserialize){if(this.useObjects&&c.hasPostMessageObjectsSupport()){this.serialize=x;this.deserialize=x}else{this.serialize=c.stringify;this.deserialize=JSON.parse}a.serialize=this.serialize;a.deserialize=this.deserialize}else{this.serialize=a.serialize;this.deserialize=a.deserialize}this.eventChannel=a.eventChannel||new d({events:a.events,commands:a.commands,reqres:a.reqres});this.mapper=new i(this.eventChannel);b=this.mapper.toEvent.bind(this.mapper);h=D(b).bind(this);this.messageChannel=new g(a,h);this.callbackCache=new e({max:c.parseNumber(a.maxConcurrency,n),ttl:c.parseNumber(a.timeout,m),interval:r});j=c.parseNumber(a.messureTime,o);this.circuit=new f({timeWindow:j,slidesNumber:Math.ceil(j/100),tolerance:c.parseNumber(a.messureTolerance,p),calibration:c.parseNumber(a.messureCalibration,q),onopen:c.parseFunction(a.ondisconnect,!0),onclose:c.parseFunction(a.onreconnect,!0)});this.once=this.eventChannel.once;this.hasFiredEvents=this.eventChannel.hasFiredEvents;this.bind=this.eventChannel.bind;this.register=this.eventChannel.register;this.unbind=this.eventChannel.unbind;this.unregister=this.eventChannel.unregister;this.hasFiredCommands=this.eventChannel.hasFiredCommands;this.comply=this.eventChannel.comply;this.stopComplying=this.eventChannel.stopComplying;this.hasFiredReqres=this.eventChannel.hasFiredReqres;this.reply=this.eventChannel.reply;this.stopReplying=this.eventChannel.stopReplying;this.initialized=!0}}function b(){return this.messageChannel}function j(){return this.eventChannel}function s(){if(!this.disposed){var a=Array.prototype.slice.apply(arguments);(2!==arguments.length&&4!==arguments.length||!0!==arguments[arguments.length-1])&&this.eventChannel.trigger.apply(this.eventChannel,a);return y.call(this,a,l.TRIGGER)}}function t(){if(!this.disposed){var a=Array.prototype.slice.apply(arguments);return y.call(this,a,l.COMMAND)}}function u(){if(!this.disposed){var a=Array.prototype.slice.apply(arguments);return y.call(this,a,l.REQUEST)}}function v(){if(!this.disposed){this.messageChannel.dispose();this.messageChannel=void 0;this.eventChannel=void 0;this.mapper=void 0;this.callbackCache=void 0;this.circuit=void 0;this.disposed=!0}}function w(){var a=c.getURLParameter("lpPMDeSerialize");return"true"===a?!1:void 0}function x(a){return a}function y(a,b){return this.circuit.run(function(c,d,e){var f=A.call(this,a,b,e);if(f)try{var g=this.messageChannel.postMessage.call(this.messageChannel,f);!1===g?d():c()}catch(h){d()}else d()}.bind(this))}function z(a,b){return this.circuit.run(function(c,d){try{var e=this.messageChannel.postMessage.call(this.messageChannel,a,b);!1===e?d():c()}catch(f){d()}}.bind(this))}function A(a,b,d){var e,f,g=c.createUniqueSequence(k+b+c.SEQUENCE_FORMAT);a.unshift(g,b);if(B(b)){if(1<a.length&&"function"==typeof a[a.length-1])e=a.pop();else if(2<a.length&&!isNaN(a[a.length-1])&&"function"==typeof a[a.length-2]){f=parseInt(a.pop(),10);e=a.pop()}if(e&&!this.callbackCache.set(g,e,f,function(a,b){d();C.call(this,a,b)}.bind(this)))return void 0}return this.mapper.toMessage.apply(this.mapper,a)}function B(a){return l.REQUEST===a||l.COMMAND===a}function C(a,b){if(a&&"function"==typeof b)try{b.call(null,new Error("Callback: Operation Timeout!"))}catch(d){c.log("Error while trying to handle the timeout using the callback","ERROR","PostMessageCourier")}}function D(a){return function(b){var d,e,f,g,i,j,k,m;if(b){i=b.method&&b.method.id;j=b.method&&b.method.name;k=b.method&&b.method.args;if(l.RETURN===j){m=this.callbackCache.get(i,!0);if("function"==typeof m){k&&k.length&&k[0]&&"Error"===k[0].type&&"string"==typeof k[0].message&&(k[0]=new Error(k[0].message));try{m.apply(null,k)}catch(n){c.log("Error while trying to handle the returned message from request/command","ERROR","PostMessageCourier")}}}else{try{B(j)&&k.length&&k.push(function(a,c){var d=a;a instanceof Error&&(d={type:"Error",message:a.message});f=[i,l.RETURN,d];l.REQUEST===j&&f.push(c);g=this.mapper.toMessage.apply(this.mapper,f);z.call(this,g,b.source)}.bind(this));d=a(b);e=d&&d()}catch(n){c.log("Error while trying to invoke the handler on the events channel","ERROR","PostMessageCourier");if(B(j)){f=[i,l.RETURN,{error:n.toString()}];g=this.mapper.toMessage.apply(this.mapper,f);z.call(this,g,b.source)}}if(B(j)&&"undefined"!=typeof e)if("undefined"!=typeof Promise&&e instanceof Promise||e instanceof h)e.then(function(a){f=[i,l.RETURN,null];l.REQUEST===j&&f.push(a);g=this.mapper.toMessage.apply(this.mapper,f);z.call(this,g,b.source)}.bind(this),function(a){f=[i,l.RETURN,a];g=this.mapper.toMessage.apply(this.mapper,f);z.call(this,g,b.source)}.bind(this));else{if(e.error){f=[i,l.RETURN,e];g=this.mapper.toMessage.apply(this.mapper,f)}else{f=[i,l.RETURN,null];l.REQUEST===j&&f.push(e);g=this.mapper.toMessage.apply(this.mapper,f)}z.call(this,g,b.source)}}}}}return{initialize:a,getMessageChannel:b,getEventChannel:j,trigger:s,publish:s,command:t,request:u,dispose:v}}();b.LPPostMessageCourier=b.LPPostMessageCourier||j});